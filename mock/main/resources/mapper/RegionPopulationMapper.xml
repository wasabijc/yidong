<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.mapper.RegionPopulationMapper">

	<!-- 实体映射 -->
	<resultMap id="base_result_map" type="com.example.entity.po.RegionPopulationEntity">
		<!--  -->
		<id column="id" property="id"/>
		<!-- 区域ID -->
		<result column="region_id" property="regionId"/>
		<!-- 统计时间窗口 -->
		<result column="time_window" property="timeWindow"/>
		<!-- 总人数 -->
		<result column="total_count" property="totalCount"/>
		<!-- 男性人数 -->
		<result column="male_count" property="maleCount"/>
		<!-- 女性人数 -->
		<result column="female_count" property="femaleCount"/>
		<!-- 0-18岁人数 -->
		<result column="age_0_18" property="age018"/>
		<!-- 19-25岁人数 -->
		<result column="age_19_25" property="age1925"/>
		<!-- 26-35岁人数 -->
		<result column="age_26_35" property="age2635"/>
		<!-- 36-45岁人数 -->
		<result column="age_36_45" property="age3645"/>
		<!-- 46-55岁人数 -->
		<result column="age_46_55" property="age4655"/>
		<!-- 56岁以上人数 -->
		<result column="age_56_plus" property="age56Plus"/>
	</resultMap>

	<!-- 通用结果查询列 -->
	<sql id="base_column_list">
		id, region_id, time_window, total_count, male_count, female_count, age_0_18, age_19_25, age_26_35, age_36_45, age_46_55, age_56_plus
	</sql>

	<!-- 基础查询条件 -->
	<sql id="base_query_condition">
		<if test="query.id != null">
			and id = #{query.id}
		</if>
		<if test="query.regionId != null and query.regionId != ''">
			and region_id = #{query.regionId}
		</if>
		<if test="query.timeWindow != null">
			and time_window = #{query.timeWindow}
		</if>
		<if test="query.totalCount != null">
			and total_count = #{query.totalCount}
		</if>
		<if test="query.maleCount != null">
			and male_count = #{query.maleCount}
		</if>
		<if test="query.femaleCount != null">
			and female_count = #{query.femaleCount}
		</if>
		<if test="query.age018 != null">
			and age_0_18 = #{query.age018}
		</if>
		<if test="query.age1925 != null">
			and age_19_25 = #{query.age1925}
		</if>
		<if test="query.age2635 != null">
			and age_26_35 = #{query.age2635}
		</if>
		<if test="query.age3645 != null">
			and age_36_45 = #{query.age3645}
		</if>
		<if test="query.age4655 != null">
			and age_46_55 = #{query.age4655}
		</if>
		<if test="query.age56Plus != null">
			and age_56_plus = #{query.age56Plus}
		</if>
	</sql>

	<!-- 扩展查询条件 -->
	<sql id="extend_query_condition">
		<if test="query.regionIdFuzzy != null and query.regionIdFuzzy != ''">
			and region_id like concat('%',#{query.regionIdFuzzy},'%')
		</if>
		<if test="query.timeWindowStart != null and query.timeWindowStart != ''">
			<![CDATA[ and time_window >= str_to_date(#{query.timeWindowStart},'%Y-%m-%d')]]>
		</if>
		<if test="query.timeWindowEnd != null and query.timeWindowEnd != ''">
			<![CDATA[ and time_window < date_add(str_to_date(#{query.timeWindowEnd},'%Y-%m-%d'), interval 1 day)]]>
		</if>
	</sql>

	<!-- 列表查询条件 WHEN 模式 -->
	<!-- 使用 WHEN，最多只有一个 WHEN 分支被执行  -->
	<sql id="list_query_condition_use_when">
		<choose>
			<when test="query.idList != null and query.idList.size() > 0">
				and id in
				<foreach collection="idList" separator="," open="(" close=")" item="id">
					#{id}
				</foreach>
			</when>
			<when test="query.regionIdList != null and query.regionIdList.size() > 0">
				and region_id in
				<foreach collection="regionIdList" separator="," open="(" close=")" item="regionId">
					#{regionId}
				</foreach>
			</when>
			<when test="query.timeWindowList != null and query.timeWindowList.size() > 0">
				and time_window in
				<foreach collection="timeWindowList" separator="," open="(" close=")" item="timeWindow">
					#{timeWindow}
				</foreach>
			</when>
			<when test="query.totalCountList != null and query.totalCountList.size() > 0">
				and total_count in
				<foreach collection="totalCountList" separator="," open="(" close=")" item="totalCount">
					#{totalCount}
				</foreach>
			</when>
			<when test="query.maleCountList != null and query.maleCountList.size() > 0">
				and male_count in
				<foreach collection="maleCountList" separator="," open="(" close=")" item="maleCount">
					#{maleCount}
				</foreach>
			</when>
			<when test="query.femaleCountList != null and query.femaleCountList.size() > 0">
				and female_count in
				<foreach collection="femaleCountList" separator="," open="(" close=")" item="femaleCount">
					#{femaleCount}
				</foreach>
			</when>
			<when test="query.age018List != null and query.age018List.size() > 0">
				and age_0_18 in
				<foreach collection="age018List" separator="," open="(" close=")" item="age018">
					#{age018}
				</foreach>
			</when>
			<when test="query.age1925List != null and query.age1925List.size() > 0">
				and age_19_25 in
				<foreach collection="age1925List" separator="," open="(" close=")" item="age1925">
					#{age1925}
				</foreach>
			</when>
			<when test="query.age2635List != null and query.age2635List.size() > 0">
				and age_26_35 in
				<foreach collection="age2635List" separator="," open="(" close=")" item="age2635">
					#{age2635}
				</foreach>
			</when>
			<when test="query.age3645List != null and query.age3645List.size() > 0">
				and age_36_45 in
				<foreach collection="age3645List" separator="," open="(" close=")" item="age3645">
					#{age3645}
				</foreach>
			</when>
			<when test="query.age4655List != null and query.age4655List.size() > 0">
				and age_46_55 in
				<foreach collection="age4655List" separator="," open="(" close=")" item="age4655">
					#{age4655}
				</foreach>
			</when>
			<when test="query.age56PlusList != null and query.age56PlusList.size() > 0">
				and age_56_plus in
				<foreach collection="age56PlusList" separator="," open="(" close=")" item="age56Plus">
					#{age56Plus}
				</foreach>
			</when>
			<otherwise>

			</otherwise>
		</choose>
	</sql>

	<!-- 列表查询条件 IF 模式  -->
	<!-- 使用 IF，可能有多个 IF 分支被执行  -->
	<sql id="list_query_condition_use_if">
		<if test="query.idList != null and query.idList.size() > 0">
			and id in
			<foreach collection="idList" separator="," open="(" close=")" item="id">
			#{id}
			</foreach>
		</if>
		<if test="query.regionIdList != null and query.regionIdList.size() > 0">
			and region_id in
			<foreach collection="regionIdList" separator="," open="(" close=")" item="regionId">
			#{regionId}
			</foreach>
		</if>
		<if test="query.timeWindowList != null and query.timeWindowList.size() > 0">
			and time_window in
			<foreach collection="timeWindowList" separator="," open="(" close=")" item="timeWindow">
			#{timeWindow}
			</foreach>
		</if>
		<if test="query.totalCountList != null and query.totalCountList.size() > 0">
			and total_count in
			<foreach collection="totalCountList" separator="," open="(" close=")" item="totalCount">
			#{totalCount}
			</foreach>
		</if>
		<if test="query.maleCountList != null and query.maleCountList.size() > 0">
			and male_count in
			<foreach collection="maleCountList" separator="," open="(" close=")" item="maleCount">
			#{maleCount}
			</foreach>
		</if>
		<if test="query.femaleCountList != null and query.femaleCountList.size() > 0">
			and female_count in
			<foreach collection="femaleCountList" separator="," open="(" close=")" item="femaleCount">
			#{femaleCount}
			</foreach>
		</if>
		<if test="query.age018List != null and query.age018List.size() > 0">
			and age_0_18 in
			<foreach collection="age018List" separator="," open="(" close=")" item="age018">
			#{age018}
			</foreach>
		</if>
		<if test="query.age1925List != null and query.age1925List.size() > 0">
			and age_19_25 in
			<foreach collection="age1925List" separator="," open="(" close=")" item="age1925">
			#{age1925}
			</foreach>
		</if>
		<if test="query.age2635List != null and query.age2635List.size() > 0">
			and age_26_35 in
			<foreach collection="age2635List" separator="," open="(" close=")" item="age2635">
			#{age2635}
			</foreach>
		</if>
		<if test="query.age3645List != null and query.age3645List.size() > 0">
			and age_36_45 in
			<foreach collection="age3645List" separator="," open="(" close=")" item="age3645">
			#{age3645}
			</foreach>
		</if>
		<if test="query.age4655List != null and query.age4655List.size() > 0">
			and age_46_55 in
			<foreach collection="age4655List" separator="," open="(" close=")" item="age4655">
			#{age4655}
			</foreach>
		</if>
		<if test="query.age56PlusList != null and query.age56PlusList.size() > 0">
			and age_56_plus in
			<foreach collection="age56PlusList" separator="," open="(" close=")" item="age56Plus">
			#{age56Plus}
			</foreach>
		</if>
	</sql>

	<!-- 通用查询条件 -->
	<sql id="general_query_condition">
		<where>
			<include refid="base_query_condition"/>
			<include refid="extend_query_condition"/>
			<include refid="list_query_condition_use_when"/>
		</where>
	</sql>

	<!-- 查询列表 -->
	<!-- 这里包含了基础、扩展以及列表查询，使用时请注意查询条件 -->
	<!-- 建议使用时new一个新的query对象，然后设置需要查询的属性条件 -->
	<select id="selectList" resultMap="base_result_map">
		select
		<include refid="base_column_list"/>
		from region_population
		<include refid="general_query_condition"/>
		<if test="query.orderBy != null">
			order by ${query.orderBy}
		</if>
		<if test="query.simplePage != null">
			limit #{query.simplePage.start},#{query.simplePage.pageSize}
		</if>
	</select>

	<!-- 查询数量 -->
	<!-- 这里包含了基础、扩展以及列表查询，使用时请注意查询条件 -->
	<!-- 建议使用时new一个新的query对象，然后设置需要查询的属性条件 -->
	<select id="selectCount" resultType="java.lang.Integer">
		select count(1) from region_population
		<include refid="general_query_condition"/>
	</select>

	<!-- 单行插入 -->
	<!-- 允许指定主键 -->
	<insert id="insert" parameterType="com.example.entity.po.RegionPopulationEntity">
		<selectKey keyProperty="bean.id" resultType="java.lang.Long" order="AFTER">
			select last_insert_id()
		</selectKey>
		insert into region_population
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				id,
			</if>
			<if test="bean.regionId != null">
				region_id,
			</if>
			<if test="bean.timeWindow != null">
				time_window,
			</if>
			<if test="bean.totalCount != null">
				total_count,
			</if>
			<if test="bean.maleCount != null">
				male_count,
			</if>
			<if test="bean.femaleCount != null">
				female_count,
			</if>
			<if test="bean.age018 != null">
				age_0_18,
			</if>
			<if test="bean.age1925 != null">
				age_19_25,
			</if>
			<if test="bean.age2635 != null">
				age_26_35,
			</if>
			<if test="bean.age3645 != null">
				age_36_45,
			</if>
			<if test="bean.age4655 != null">
				age_46_55,
			</if>
			<if test="bean.age56Plus != null">
				age_56_plus,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				#{bean.id},
			</if>
			<if test="bean.regionId != null">
				#{bean.regionId},
			</if>
			<if test="bean.timeWindow != null">
				#{bean.timeWindow},
			</if>
			<if test="bean.totalCount != null">
				#{bean.totalCount},
			</if>
			<if test="bean.maleCount != null">
				#{bean.maleCount},
			</if>
			<if test="bean.femaleCount != null">
				#{bean.femaleCount},
			</if>
			<if test="bean.age018 != null">
				#{bean.age018},
			</if>
			<if test="bean.age1925 != null">
				#{bean.age1925},
			</if>
			<if test="bean.age2635 != null">
				#{bean.age2635},
			</if>
			<if test="bean.age3645 != null">
				#{bean.age3645},
			</if>
			<if test="bean.age4655 != null">
				#{bean.age4655},
			</if>
			<if test="bean.age56Plus != null">
				#{bean.age56Plus},
			</if>
		</trim>
	</insert>

	<!-- 插入或更新（只要存在任一唯一键冲突就更新，否则插入） -->
	<!-- 允许null值覆盖非null值 -->
	<!-- 允许指定或更新主键 -->
	<!-- 允许指定或更新唯一键 -->
	<insert id="insertOrUpdate" parameterType="com.example.entity.po.RegionPopulationEntity">
		<selectKey keyProperty="bean.id" resultType="java.lang.Long" order="AFTER">
			select last_insert_id()
		</selectKey>
		insert into region_population
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				id,
			</if>
			<if test="bean.regionId != null">
				region_id,
			</if>
			<if test="bean.timeWindow != null">
				time_window,
			</if>
			<if test="bean.totalCount != null">
				total_count,
			</if>
			<if test="bean.maleCount != null">
				male_count,
			</if>
			<if test="bean.femaleCount != null">
				female_count,
			</if>
			<if test="bean.age018 != null">
				age_0_18,
			</if>
			<if test="bean.age1925 != null">
				age_19_25,
			</if>
			<if test="bean.age2635 != null">
				age_26_35,
			</if>
			<if test="bean.age3645 != null">
				age_36_45,
			</if>
			<if test="bean.age4655 != null">
				age_46_55,
			</if>
			<if test="bean.age56Plus != null">
				age_56_plus,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				#{bean.id},
			</if>
			<if test="bean.regionId != null">
				#{bean.regionId},
			</if>
			<if test="bean.timeWindow != null">
				#{bean.timeWindow},
			</if>
			<if test="bean.totalCount != null">
				#{bean.totalCount},
			</if>
			<if test="bean.maleCount != null">
				#{bean.maleCount},
			</if>
			<if test="bean.femaleCount != null">
				#{bean.femaleCount},
			</if>
			<if test="bean.age018 != null">
				#{bean.age018},
			</if>
			<if test="bean.age1925 != null">
				#{bean.age1925},
			</if>
			<if test="bean.age2635 != null">
				#{bean.age2635},
			</if>
			<if test="bean.age3645 != null">
				#{bean.age3645},
			</if>
			<if test="bean.age4655 != null">
				#{bean.age4655},
			</if>
			<if test="bean.age56Plus != null">
				#{bean.age56Plus},
			</if>
		</trim>
		on duplicate key update
		id = values(id),
		region_id = values(region_id),
		time_window = values(time_window),
		total_count = values(total_count),
		male_count = values(male_count),
		female_count = values(female_count),
		age_0_18 = values(age_0_18),
		age_19_25 = values(age_19_25),
		age_26_35 = values(age_26_35),
		age_36_45 = values(age_36_45),
		age_46_55 = values(age_46_55),
		age_56_plus = values(age_56_plus)
	</insert>

	<!-- 批量插入 -->
	<!-- 允许指定主键，不允许更新自增键 -->
	<insert id="insertBatch" parameterType="com.example.entity.po.RegionPopulationEntity">
		insert into
		region_population(region_id,time_window,total_count,male_count,female_count,age_0_18,age_19_25,age_26_35,age_36_45,age_46_55,age_56_plus)
		values
		<foreach collection="list" item="item" separator=",">
			(
			#{item.regionId},#{item.timeWindow},#{item.totalCount},#{item.maleCount},#{item.femaleCount},#{item.age018},#{item.age1925},#{item.age2635},#{item.age3645},#{item.age4655},#{item.age56Plus}
			)
		</foreach>
	</insert>

	<!-- 批量插入或更新 -->
	<!-- 允许null值覆盖非null值 -->
	<!-- 允许指定或更新主键，不允许更新自增键 -->
	<!-- 允许指定或更新非自增的的唯一键 -->
	<insert id="insertOrUpdateBatch" parameterType="com.example.entity.po.RegionPopulationEntity">
		insert into
		region_population(region_id,time_window,total_count,male_count,female_count,age_0_18,age_19_25,age_26_35,age_36_45,age_46_55,age_56_plus)
		values
		<foreach collection="list" item="item" separator=",">
			(
			#{item.regionId},#{item.timeWindow},#{item.totalCount},#{item.maleCount},#{item.femaleCount},#{item.age018},#{item.age1925},#{item.age2635},#{item.age3645},#{item.age4655},#{item.age56Plus}
			)
		</foreach>
		on duplicate key update
		region_id = values(region_id),
		time_window = values(time_window),
		total_count = values(total_count),
		male_count = values(male_count),
		female_count = values(female_count),
		age_0_18 = values(age_0_18),
		age_19_25 = values(age_19_25),
		age_26_35 = values(age_26_35),
		age_36_45 = values(age_36_45),
		age_46_55 = values(age_46_55),
		age_56_plus = values(age_56_plus)
	</insert>

	<!-- 根据Id查询 -->
	<select id="selectById" resultMap="base_result_map">
		select
		<include refid="base_column_list"/>
		from region_population
		where id=#{id}
	</select>

	<!-- 根据Id更新 -->
	<!-- 不允许null值覆盖非null值（若用一条除主键外全是null的数据更新，则报错） -->
	<!-- 允许指定主键 -->
	<update id="updateById" parameterType="com.example.entity.po.RegionPopulationEntity">
		update region_population
		<set>
			<if test="bean.id != null">
				id = #{bean.id},
			</if>
			<if test="bean.regionId != null">
				region_id = #{bean.regionId},
			</if>
			<if test="bean.timeWindow != null">
				time_window = #{bean.timeWindow},
			</if>
			<if test="bean.totalCount != null">
				total_count = #{bean.totalCount},
			</if>
			<if test="bean.maleCount != null">
				male_count = #{bean.maleCount},
			</if>
			<if test="bean.femaleCount != null">
				female_count = #{bean.femaleCount},
			</if>
			<if test="bean.age018 != null">
				age_0_18 = #{bean.age018},
			</if>
			<if test="bean.age1925 != null">
				age_19_25 = #{bean.age1925},
			</if>
			<if test="bean.age2635 != null">
				age_26_35 = #{bean.age2635},
			</if>
			<if test="bean.age3645 != null">
				age_36_45 = #{bean.age3645},
			</if>
			<if test="bean.age4655 != null">
				age_46_55 = #{bean.age4655},
			</if>
			<if test="bean.age56Plus != null">
				age_56_plus = #{bean.age56Plus},
			</if>
		</set>
		where id=#{id}
	</update>

	<!-- 根据Id删除 -->
	<delete id="deleteById">
		delete
		from region_population
		where id=#{id}
	</delete>

	<!-- 根据IdList列表查询 -->
	<select id="selectByIdList" resultMap="base_result_map">
		select
		<include refid="base_column_list"/>
		from region_population
		where id in
		<foreach collection="idList" separator="," open="(" close=")" item="id">
			#{id}
		</foreach>
	</select>

	<!-- 根据RegionIdAndTimeWindow查询 -->
	<select id="selectByRegionIdAndTimeWindow" resultMap="base_result_map">
		select
		<include refid="base_column_list"/>
		from region_population
		where region_id=#{regionId} and time_window=#{timeWindow}
	</select>

	<!-- 根据RegionIdAndTimeWindow更新 -->
	<!-- 不允许null值覆盖非null值（若用一条除主键外全是null的数据更新，则报错） -->
	<!-- 允许指定主键 -->
	<update id="updateByRegionIdAndTimeWindow" parameterType="com.example.entity.po.RegionPopulationEntity">
		update region_population
		<set>
			<if test="bean.id != null">
				id = #{bean.id},
			</if>
			<if test="bean.regionId != null">
				region_id = #{bean.regionId},
			</if>
			<if test="bean.timeWindow != null">
				time_window = #{bean.timeWindow},
			</if>
			<if test="bean.totalCount != null">
				total_count = #{bean.totalCount},
			</if>
			<if test="bean.maleCount != null">
				male_count = #{bean.maleCount},
			</if>
			<if test="bean.femaleCount != null">
				female_count = #{bean.femaleCount},
			</if>
			<if test="bean.age018 != null">
				age_0_18 = #{bean.age018},
			</if>
			<if test="bean.age1925 != null">
				age_19_25 = #{bean.age1925},
			</if>
			<if test="bean.age2635 != null">
				age_26_35 = #{bean.age2635},
			</if>
			<if test="bean.age3645 != null">
				age_36_45 = #{bean.age3645},
			</if>
			<if test="bean.age4655 != null">
				age_46_55 = #{bean.age4655},
			</if>
			<if test="bean.age56Plus != null">
				age_56_plus = #{bean.age56Plus},
			</if>
		</set>
		where region_id=#{regionId} and time_window=#{timeWindow}
	</update>

	<!-- 根据RegionIdAndTimeWindow删除 -->
	<delete id="deleteByRegionIdAndTimeWindow">
		delete
		from region_population
		where region_id=#{regionId} and time_window=#{timeWindow}
	</delete>


</mapper>
